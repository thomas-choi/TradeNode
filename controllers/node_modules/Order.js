// JScript source code
var util = require('util');
var APL = require('./Log');
var HashO = require('./hash');
var Orders = HashO.CreateHash();

BS = {    BUY: -1,    SELL : 1
}
STATUS = {    UNDE : 0,    PEND : 1,    REJE : -1,    COMP : 3,    CANC : 4
}    
TYPE = { LMT : 0, MKT : 1 
}
function pad(num, size) {  // up to 3 
    var s = '00' + num;
    return s.substr(s.length-size); 
}
function ordHeader() {
    return 'account,bs,symbol,filled,avgPrice,ID,verion';
}
function Order() { 
    this.symbol = '';
    this.qty = 0.0;
    this.price = 0.0;
    this.bs = 0;
    this.ordtype = TYPE.LMT;
    this.status = STATUS.UNDE;
    this.filled = 0.0;
    this.avgPx = 0.0;   
    this.account = ''; 
    this.ID = genUniqueID(); 
    this.ver = 1; 
    this.Ref = this.ID+'.'+this.ver;
    this.Time = '';
    this.remark = '';
    this.genSStr = function(sep) {
        var  ss = this.account+sep+this.bs+sep+this.symbol+sep+this.filled+sep+this.avgPx+sep+this.ID+sep+this.ver;
        return ss;
    }  
    this.toString = function() {
        return util.inspect(this);
    }
    this.nxtVer = function() {
        this.ver += 1;
        this.Ref = this.ID+'.'+this.ver;
    }
}
function CreateOrder() {
    return new Order();
}

function genUniqueID() {
    var   dkey = new Date();  
    return pad(dkey.getDate(),2)+pad(dkey.getHours(),2)+pad(dkey.getMinutes(),2)+pad(dkey.getSeconds(),2)+pad(dkey.getMilliseconds(),3);
}

function getOrder(ID) {
    return Orders.getItem(ID);
}

function setOrder(order) {
    return Orders.setItem(order.ID, order);
} 
 
module.exports.create = CreateOrder;
module.exports.getOrder = getOrder
module.exports.setOrder = setOrder
module.exports.BS = BS;
module.exports.STATUS = STATUS;
module.exports.TYPE = TYPE;
module.exports.ordHeader = ordHeader;
