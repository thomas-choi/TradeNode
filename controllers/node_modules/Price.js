// JScript source code
/*
enum PF {
    SYMBOL            = '0',
    BID                   = '1',
    ASK                  = '2',
    LAST                 = '3',
    QTY                  = '4',
    STATUS             = '5',
    BID_SIZE            = '16',
    VOLUME            = '17',
    ASK_SIZE           = '19',
    EXCHANGE        = '20',
    NAME               = '21',
    PRODTYPE         = '22',
    CURRENCY        = '23',
    LOTSIZE            = '24',
    TEXT                 = '25',
    UNDERLY          = '26',
    STRIKE_PX         = '27',
    PUTCALL           = '28',
    MATURITY        = '29',
    PCLOSE             = '31',
    LOW                  = '32',       
    TIME                 = '33',
    HIGH                 = '37',
    TURNOVER        = '38',  
    BID_SIZE_2         = '51',
    BID_SIZE_3         = '52',
    BID_SIZE_4         = '53',
    BID_SIZE_5         = '54',
    ASK_SIZE_2        = '61',
    ASK_SIZE_3        = '62',
    ASK_SIZE_4        = '63'
};    */

var   PriceObj = new Object();

function ParseTime(timestr) {
    var        cDate = new Date();
    tSp1 = timestr.indexOf(':', 0);
    tSp2 = timestr.indexOf(':', 3) 
    tSp3 = timestr.indexOf(':', 5) 
    cDate.setHours(parseInt(tSp1), parseInt(tSp2), parseInt(tSp3));  
     return cDate;
}

function Parse(line) {
   var   splitPx = line.split('|');
   PriceObj.symbol = splitPx[ 1];
   
   for (i=2; i < splitPx.length; i+=2) {
        switch (splitPx[i]) {
            case '1': PriceObj.bid = parseFloat(splitPx[i+1]); break;
            case '2': PriceObj.ask = parseFloat(splitPx[i+1]); break;
            case '3': PriceObj.last = parseFloat(splitPx[i+1]); break;
            case '33': PriceObj.time = ParseTime(splitPx[i+1]); break;
            case '31': PriceObj.pclose = parseFloat(splitPx[i+1]); break;
            case '16': PriceObj.bid_size = parseFloat(splitPx[i+1]); break;
            case '19': PriceObj.ask_size = parseFloat(splitPx[i+1]); break;
            case '20': PriceObj.exchange = splitPx[i+1]; break;
            case '21': PriceObj.name = splitPx[i+1]; break;
        }      
   } 
}

function objectToString(o){
    
    var parse = function(_o){
        var a = [], t;
        
        for(var p in _o){      
            if(_o.hasOwnProperty(p)){   
                t = _o[p];
                if(t && typeof t == "object"){                
                    a[a.length]= p + ":{ " + arguments.callee(t).join(", ") + "}";                    
                }
                else {
                    if(typeof t == "string"){
                        a[a.length] = [ p+ ": \"" + t.toString() + "\"" ];
                    }
                    else{
                        a[a.length] = [ p+ ": " + t.toString()];
                    }
                }
            }
        }
        return a;
    }
    return "{" + parse(o).join(", ") + "}";
}

exports.PriceObj = PriceObj;
exports.objectToString = objectToString;
exports.Parse = Parse;
